{% extends 'base.html' %}

{% block content %}
<div class="fade-in">
    <div class="text-center mb-30">
        <h2>Search the Database</h2>
        <form method="POST" action="{{ url_for('search') }}"
            style="display: flex; gap: 10px; margin-bottom: 30px; flex-wrap: wrap;">
            <div style="flex-grow: 1; display: flex; gap: 10px;">
                <input type="text" name="query" placeholder="Search for movies or TV shows..." class="form-control"
                    required>
                <button type="submit" class="btn btn-primary">Search</button>
            </div>

            <div class="glass-card"
                style="padding: 0 15px; display: flex; align-items: center; gap: 15px; border-radius: 50px;">
                <label style="cursor: pointer; display: flex; align-items: center; gap: 5px;">
                    <input type="radio" name="search_type" value="movie" {{ 'checked' if search_type=='movie' else ''
                        }}>
                    <span>Movies</span>
                </label>
                <label style="cursor: pointer; display: flex; align-items: center; gap: 5px;">
                    <input type="radio" name="search_type" value="tv" {{ 'checked' if search_type=='tv' else '' }}>
                    <span>TV Series</span>
                </label>
            </div>
        </form>
    </div>

    {% if movies %}
    <div class="movie-grid">
        {% for movie in movies %}
        <div class="movie-card">
            <a href="{{ url_for('movie_details', tmdb_id=movie.id, media_type=movie.media_type) }}"
                style="display: block; width: 100%; height: 100%;">
                {% if movie.poster_path %}
                <img src="https://image.tmdb.org/t/p/w500{{ movie.poster_path }}" alt="{{ movie.title }}">
                {% else %}
                <img src="https://via.placeholder.com/500x750?text=No+Image" alt="{{ movie.title }}">
                {% endif %}
            </a>

            <div class="movie-info">
                <h3 class="movie-title">{{ movie.title }}</h3>
                <p style="font-size: 0.8rem; margin-bottom: 10px;">{{ movie.release_date[:4] if movie.release_date else
                    'Unknown' }}</p>

                <form action="{{ url_for('add') }}" method="POST">
                    <input type="hidden" name="title" value="{{ movie.title }}">
                    <input type="hidden" name="poster" value="{{ movie.poster_path }}">
                    <input type="hidden" name="tmdb_id" value="{{ movie.id }}">
                    <input type="hidden" name="media_type" value="{{ movie.media_type }}">

                    {% if user_lists %}
                    <select name="list_id"
                        style="padding: 8px; font-size: 0.8rem; margin-bottom: 10px; background: rgba(0,0,0,0.5);">
                        {% for lst in user_lists %}
                        <option value="{{ lst.id }}">{{ lst.name }}</option>
                        {% endfor %}
                    </select>
                    {% endif %}

                    <button type="submit" class="btn btn-neon"
                        style="width: 100%; font-size: 0.8rem; padding: 10px;">Add to Collection</button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endblock %}